<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Details</title>
    <!-- <link rel="stylesheet" href="/css/styles.css"> -->

        <meta name="description" content="">

        <!-- Facebook Meta Tags -->
        <meta property="og:url" content="https://efroai.net/view-character.html?uploader=tigert2173&characterId=4">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Chara1cter Details">
        <meta property="og:description" content="">
        <!--
        You can generate this image URL dynamically: https://ogcdn.net/c078a98b-9a33-4eaf-a5cf-e5ebf3ea450c/v1/{site_text}/{title_text}/{description_text}/{image_url}/og.png
        Replace the variables in the brackets with your own values and use this URL in the image tag below this comment. Ensure values are URL encoded.
        For more information, read: https://www.opengraph.xyz/blog/how-to-implement-dynamic-open-graph-images
        -->
        <meta property="og:image" content="https://ogcdn.net/c078a98b-9a33-4eaf-a5cf-e5ebf3ea450c/v1/efroai.net/Character%20Details/If%20you%E2%80%99re%20an%20online%20store%20owner%2C%20you%20should%20be%20using%20Meta%20Ads%20campaigns.%20Here%20is%20a%20three-tiered%20campaign%20strategy%20that%20will%20boost%20your%20online%20e-commerce%20sales./https%3A%2F%2Fefroai.netundefined/og.png">

        <!-- Twitter Meta Tags -->
        <meta name="twitter:card" content="summary_large_image">
        <meta property="twitter:domain" content="efroai.net">
        <meta property="twitter:url" content="https://efroai.net/view-character.html?uploader=tigert2173&characterId=4">
        <meta name="twitter:title" content="Character Details">
        <meta name="twitter:description" content="">
        <!--
        You can generate this image URL dynamically: https://ogcdn.net/c078a98b-9a33-4eaf-a5cf-e5ebf3ea450c/v1/{site_text}/{title_text}/{description_text}/{image_url}/og.png
        Replace the variables in the brackets with your own values and use this URL in the image tag below this comment. Ensure values are URL encoded.
        For more information, read: https://www.opengraph.xyz/blog/how-to-implement-dynamic-open-graph-images
        -->
        <meta name="twitter:image" content="https://ogcdn.net/c078a98b-9a33-4eaf-a5cf-e5ebf3ea450c/v1/efroai.net/Character%20Details/If%20you%E2%80%99re%20an%20online%20store%20owner%2C%20you%20should%20be%20using%20Meta%20Ads%20campaigns.%20Here%20is%20a%20three-tiered%20campaign%20strategy%20that%20will%20boost%20your%20online%20e-commerce%20sales./https%3A%2F%2Fefroai.netundefined/og.png">

        <!-- Meta Tags Generated via https://www.opengraph.xyz -->
        
    <style>
        body {
            background-color: #1c1c1c; /* Dark background for contrast */
            color: #eaeaea; /* Light text for readability */
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }

        #character-details-container {
            max-width: 600px;
            margin: auto;
            background: rgb(12, 36, 10);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            padding: 30px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        #character-details-container:hover {
            transform: translateY(-5px); /* Subtle lift on hover */
        }

        h1 {
            font-size: 28px; /* Increased font size */
            margin-bottom: 15px;
            color: #00ff66;
        }

        #character-image {
            width: auto;
            max-height: 500px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 3px solid #00ff66; /* Bright border for images */

        }

        #character-description {
            font-size: 18px; /* Increased font size */
            margin: 15px 0;
            color: #dedede;
        }
       
        #character-creator {
            font-size: 20px; /* Increased font size for the creator's name */
            color: #ffcc00; /* Yellow color for emphasis */
            margin-bottom: 25px; /* Increased margin for spacing */
            font-weight: bold; /* Bold text for emphasis */
        }

        #character-tags {
            font-size: 16px; /* Increased font size for tags */
            margin-bottom: 20px;
        }

        .tag {
            display: inline-block;
            background-color: #333;
            color: #00ff66;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 2px 3px;
        }

        #chat-button {
            background-color: #00ff66;
            color: #1b1b1b;
            padding: 15px 25px; /* Increased padding */
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            font-size: 18px; /* Increased font size */
        }

        #chat-button:hover {
            background-color: #00e55d; /* Darker shade on hover */
            transform: translateY(-2px);
        }

        #chat-button:focus {
            outline: none; /* Remove focus outline */
        }

        /* Mobile Styles */
        @media (max-width: 600px) {
            #character-details-container {
                padding: 20px; /* Less padding on mobile */
            }

            h1 {
                font-size: 24px; /* Adjust heading size on mobile */
            }

            #character-description,
            #character-creator,
            #chat-button {
                font-size: 16px; /* Consistent font size on mobile */
            }
        }
    </style>
</head>
<body>
    <div id="character-details-container">
        <h1 id="character-name"></h1>
        <img id="character-image" alt="Character Image">
        <p id="character-description"></p>
        <p id="character-tags"></p>
        <p id="character-creator"></p>
        <button id="chat-button" style="display: none;">Chat</button>
    </div>
    <script>
        const backendurl = 'https://characters.efroai.net:3000';

        // Function to parse URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                uploader: params.get('uploader'),
                characterId: params.get('characterId')
            };
        }

        // Function to load character details
        function loadCharacterDetails() {
            const { characterId, uploader } = getUrlParams();
            fetch(`${backendurl}/api/chat/${uploader}/${characterId}`)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else if (response.status === 403) {
                        throw new Error('Character is not approved.');
                    } else if (response.status === 404) {
                        throw new Error('Character or user not found.');
                    } else {
                        throw new Error('An error occurred while fetching character details.');
                    }
                })
                .then(character => displayCharacterDetails(character))
                .catch(error => {
                    console.error('Error fetching character details:', error);
                    document.getElementById('character-details-container').innerHTML = `<p>${error.message}</p>`;
                });
        }

        // Function to display character details on the page
        function displayCharacterDetails(character) {
            document.getElementById('character-name').textContent = character.name;
            document.getElementById('character-description').textContent = character.chardescription || 'No description available.';
            document.getElementById('character-creator').textContent = `Created by: ${character.uploader || 'Unknown'}`;

            // Display tags
            const tagsElement = document.getElementById('character-tags');
            tagsElement.innerHTML = (character.tags || []).map(tag => `<span class="tag">${tag}</span>`).join(' ');

            // Display character image with fetch and error handling
            const imgElement = document.getElementById('character-image');
            const imageUrl = `${backendurl}/api/characters/${character.uploader}/images/${character.id}`;

            fetch(imageUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'image/avif,image/webp,image/png,image/svg+xml,image/jpeg,image/*;q=0.8,*/*;q=0.5'
                }
            })
            .then(response => {
                if (!response.ok) {
                    console.error(`Failed to fetch image: ${response.statusText}`);
                    imgElement.src = 'noimage.jpg'; // Fallback to default image
                    return;
                }
                return response.blob();
            })
            .then(imageBlob => {
                if (imageBlob) {
                    const imageObjectURL = URL.createObjectURL(imageBlob);
                    imgElement.src = imageObjectURL;
                }
            })
            .catch(error => {
                console.error('Error fetching image:', error);
                imgElement.src = 'noimage.jpg'; // Fallback to default image
            });

            // Display the "Chat" button
            const chatButton = document.getElementById('chat-button');
            chatButton.style.display = 'inline-block';
            chatButton.onclick = () => openCharacterPage(character.id, character.uploader);
        }

        // Function to navigate to the chat page
        function openCharacterPage(characterId, uploader) {
            window.location.href = `/chat.html?uploader=${encodeURIComponent(uploader)}&characterId=${encodeURIComponent(characterId)}`;
        }

        // Load character details on page load
        document.addEventListener('DOMContentLoaded', loadCharacterDetails);
    </script>
</body>
</html>
