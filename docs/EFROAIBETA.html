<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFRO.AI - BETA</title>
    <link rel="stylesheet" href="EFROAIBETA.css">
</head>
<body>

    <div id="sidebar">
    <button id="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle Sidebar">
        <span id="toggle-icon">☰</span>
    </button>
        <h2>Character Selection</h2>
        <ul id="character-list">
            <!-- Characters will be listed here -->
        </ul>
        <button onclick="addNewCharacter()">Add New Character</button>
        <div id="upload-container">
            <input type="file" id="upload-json" accept=".json" />
            <button onclick="uploadCharacter()">Upload Character</button>
            <button onclick="downloadJSONConfig()">Download JSON Config</button>
            <br><br><br><br>
            <a class="back-link" href="">Back to Database Catalog</a>
        </div>
    </div>

    <div id="main-content">
        <div id="branding">
            <h1>BETA EFRO.AI Chat</h1>
        </div>

        <div id="chat-container"></div>

        <div id="input-container">
            <textarea type="text" id="user-input" placeholder="Type your message here..." rows="5" style="width: 75%;"></textarea>
            <button onclick="sendMessage()">Send</button>
            <button onclick="regenerateMessage()">Regenerate Message</button>

        </div>
            <div class="status">
                <p>Number of jobs in queue: <span id="queue-count" class="queue">0</span></p>
            </div>
            <div id="speed-indicator-container">
                <div id="speed-indicator" class="speed-indicator"></div>
            </div>
            <div id="api-status">API Status: <span id="api-status-text" class="status-checking">Checking...</span></div>
            
        <div id="settings-container">
            <div class="setting">
                <label for="user-name">Your Name: </label>
                <input type="text" id="user-name" placeholder="replaces {{user}} with your name." oninput="usernameupdated()">
            </div>
            <div class="setting">
                <label for="persona">Character Persona</label>
                <textarea type="text" id="persona" placeholder="e.g., friendly, professional" rows="10" style="width: 100%;"></textarea>
            </div>
            <div class="setting">
                <label for="context">Context</label>
                <textarea type="text" id="context" placeholder="e.g., tech support, storytelling" rows="10" style="width: 100%;"></textarea>
            </div>
            <div class="setting">
                <label for="scenario">Scenario</label>
                <textarea type="text" id="scenario" placeholder="e.g., tech support, storytelling" rows="10" style="width: 100%;"></textarea>
            </div>
            <div class="setting">
                <label for="greeting">Greeting</label>
                <textarea type="text" id="greeting" placeholder="e.g., Hello! How can I help you?" rows="10" style="width: 100%;"></textarea>
            </div>
            <div class="setting">
                <label for="exampledialogue">Example Dialogue</label>
                <textarea type="text" id="exampledialogue" placeholder="" rows="10" style="width: 100%;"></textarea>
            </div>
            <div class="setting">
                <label for="temperature">Temperature</label>
                <input type="number" id="temperature" min="0" max="1" step="0.1" value="0.5">
            </div>
            <div class="setting">
                <label for="SettingsMaxTokensSlider">Max Generated Tokens (Message Length):</label>
                <input type="range" id="SettingsMaxTokensSlider" min="64" max="512" step="16" value="256">
                <span id="SettingsMaxTokensValue">256 Tokens</span>
            </div>
            <div class="setting">
                <label for="model">Select Model</label>
                <select id="model">
                    <!-- Options will be populated here -->
                </select>
            </div>
            <div class="setting">
                <a class="add-api" target="_blank" href="https://api.botbridge.net">Add API</a>
            </div>
            <div class="setting">
                <label for="messages-sent">Messages Sent</label>
                <input type="text" id="messages-sent" value="0" readonly>
            </div>
            <div id="save-load-container">
                <button onclick="saveCharacter()">Save Character</button>
                <button onclick="updateSettings()">Update Settings</button>
            </div>
            <div class="setting">
                <label for="advanced-debugging">Debugging</label>
                <textarea id="advanced-debugging" value="" rows="20" style="width: 100%;" readonly></textarea>
            </div>
            <!-- Checkbox -->
            <label for="show-expert">Show Expert Settings:</label>
            <input type="checkbox" id="show-expert" onchange="toggleExpertSettings()">
        </div>
        
        <!-- Expert Settings Section -->
        <div id="expert-settings">
            <h3>Expert Settings</h3>
            <!-- Expert settings go here -->
            <label for="ESettingslastNUMsentencesSlider">How many sentences to use from most recent context:</label>
            <input type="range" id="ESettingslastNUMsentencesSlider" min="1" max="100" step="1" value="25">
            <span id="ESettingslastNUMsentencesValue">Last 25 Sentences</span>

            <label for="ESettingsRandomNUMsentencesSlider">Number of Random Sentences to select from context:</label>
            <input type="range" id="ESettingsRandomNUMsentencesSlider" min="1" max="100" step="1" value="10">
            <span id="ESettingsRandomNUMsentencesValue">Select 10 Random Sentences</span>
            <br><i>Older Content has a lower and lower chance of being selected</i>
            <label for="setting2">Expert Setting 2:</label>
            <input type="text" id="setting2"><br><br>

            <label for="setting3">Expert Setting 3:</label>
            <input type="text" id="setting3"><br><br>
        </div>

        <br>
        <a class="back-link" href="PrivacyPolicy.html">Privacy Policy</a>
    </div>

    <script src="EFROAIBETA.js"></script>
    <script>
        // Function to populate the character settings form
function populateCharacterSettings() {
    // Retrieve the character data from localStorage
    const selectedCharacterId = localStorage.getItem('selectedCharacterId');
    const characterUploader = localStorage.getItem('characterUploader');

    // Fetch the character data from the backend
    const url = `https://characters.efroai.net:3000/api/chat/${characterUploader}/${selectedCharacterId}`;
    
    fetch(url)
        .then(response => response.json())
        .then(character => {
            // Populate each field with the character's data
            document.getElementById('user-name').value = character.uploader || '';
            document.getElementById('persona').value = character.persona || '';
            document.getElementById('context').value = character.context || '';
            document.getElementById('scenario').value = character.scenario || '';
            document.getElementById('greeting').value = character.greeting || '';
            document.getElementById('exampledialogue').value = character.exampledialogue || '';
        })
        .catch(error => {
            console.error('Error fetching character data:', error);
        });
}

// Call this function on page load to populate the fields
document.addEventListener('DOMContentLoaded', populateCharacterSettings);

    </script>
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const isMinimized = sidebar.classList.toggle('minimized');
            document.getElementById('sidebar-toggle').textContent = isMinimized ? '☰' : '✕';
        }
    </script>
    
    <script>
        const socket = new WebSocket('wss://efroai.net'); // Update with your domain
    
        // Connection opened
        socket.addEventListener('open', (event) => {
            console.log('Connected to WebSocket server');
        });
    
        // Listen for messages
        socket.addEventListener('message', (event) => {
            console.log('Message from server:', event.data);
            // Handle ping or any other messages from the server
            if (event.data === 'ping') {
                // You can respond to pings if needed
                socket.send('pong'); // Example response
            }
        });
    
        // Connection closed
        socket.addEventListener('close', (event) => {
            console.log('Disconnected from WebSocket server');
        });
    </script>
    
</body>
</html>
